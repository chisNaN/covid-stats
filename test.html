
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Covid-19 stats</title>
    <meta name="description" content="Statistics on covid-19 with percentage lethality per country">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css">
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <main class="container flex">
      <table>
      </table>
      <div>
      </div>
    </main>
    
    <script type="module">
      /*
      const abortControllers = new Map();
const controller = new AbortController();
  const { signal } = controller;
  console.warn('signal', signal)
  //abortControllers.set(item.id, controller);
  
  try {
  // the following file is already >50mo
  let url = 'https://covid.ourworldindata.org/data/owid-covid-data.json'
  //const url = 'https://ipfs.infura.io/ipfs/QmRCExDB4UG2dY3Y433atf8y9h4tfbmfmRugSMcNbrpdFA'
    const response = await fetch(url, { signal });
const contentLength = +response.headers.get('Content-Length');
console.warn('contentLength', contentLength)
    const chunks = [];
    let downloaded = 0;
    let lastUpdated = 0;
    const reader = response.body.getReader();

    while (true) {
      const { done, value } = await reader.read();
      if (done) break;
      downloaded += value.length;
      chunks.push(value);
      const now = Date.now();
      const progress = +((downloaded / contentLength) * 100).toFixed(2);
          console.log('progress ', progress)

      if (now - lastUpdated > 500 || progress === 1) {

        //updateItem(item.id, { progress });
        lastUpdated = now;
        console.warn('lastUpdated', lastUpdated)
      }
      
    }

    //const cache = await caches.open(item.id);
    const inMemoryResponse = new Response(new Blob(chunks), { headers: response.headers });
    //await cache.put(item.src, inMemoryResponse);
    console.log('inMemoryResponse ', inMemoryResponse)
    //updateItem(item.id, { state: 'stored', progress: 1 });
  } catch (err) {
    console.warn('error ', err)
    //if (err.name === 'AbortError') return;
   //updateItem(item.id, { state: 'failed' });
  }
  */
  const xhr = new XMLHttpRequest()
                        //   xhr.open('post', TEMPORAL_CLOUD_IPFS_DOWNLOAD_ENDPOINT + hash)
                          xhr.open('get', 'https://covid.ourworldindata.org/data/owid-covid-data.json')
                          //xhr.responseType = 'text'
                          // xhr.setRequestHeader('Cache-Control', 'no-cache')
                          // xhr.setRequestHeader('Authorization', 'Bearer ' + sessionInfo.token)
                          xhr.addEventListener('progress', event => {
                              if (event.lengthComputable) {
                                  // console.log('event', event);
                                  const percent = +((event.loaded / event.total) * 100).toFixed(2)
                                                                    console.log('percent', percent);

                                  //this.setState({ ['videoPercent-' + k]: `${percent} %` })
                              } else {
                                  console.warn('cannot retrieve total file size from infura ipfs')
                                  //reject('cannot retrieve total file size from infura ipfs')
                              }
                          })
                          xhr.addEventListener('loadend', () => console.log('end'))
                          xhr.addEventListener('load', () => console.log(JSON.parse(xhr.responseText)))
                          xhr.addEventListener('error', console.warn)
                          xhr.send()
    </script>
  </body>
</html>
